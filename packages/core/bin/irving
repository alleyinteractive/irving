#!/usr/bin/env node
/* eslint-disable global-require, max-len */
// Initialize env vars as soon as possible for the CLI.
require('../config/env')();
const { Command } = require('commander');
const program = new Command();

['react', 'react-dom'].forEach((dependency) => {
  try {
    // When 'npm link' is used it checks the clone location. Not the project.
    require.resolve(dependency);
  } catch (err) {
    console.warn(
      `The module '${dependency}' was not found. Irving requires that you include it in 'dependencies' of your 'package.json'. To add it, run 'npm install --save ${dependency}'`
    );
  }
});

program.command('build')
  .description('run a production build for your Irving app')
  .option('-a --analyze', 'analyze build results with BundleAnalyzer webpack plugin')
  .action((cmdObj) => {
    process.env.NODE_ENV = 'production';
    require('../cli/build')(cmdObj);
  });

program.command('start')
  .description('start your irving app from a production build')
  .action(() => {
    process.env.NODE_ENV = 'production';
    require('../cli/start');
  });

program.command('dev')
  .description('build your Irving app, watch for changes, and refresh with HMR')
  .action(() => {
    process.env.NODE_ENV = 'production';
    require('../cli/dev');
  });

program.command('link-all', 'npm link all Irving packages installed in your');

program.parse(process.argv);
