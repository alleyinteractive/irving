#!/usr/bin/env node
const chalk = require('chalk');
const inquirer = require('inquirer');
const { execSync } = require('child_process');

const releaseBranches = execSync('git branch --all')
  .toString('utf8')
  .split('\n  ')
  .filter((branch) => (
    branch.indexOf('release') === 0 ||
    branch.indexOf('remotes/origin/release') === 0
  ))
  .map((branch) => (
    branch
      .replace('remotes/origin/', '')
      .replace('*', '')
      .trim()
  ))
  .reverse();

inquirer
  .prompt([
    {
      type: 'list',
      choices: releaseBranches,
      name: 'releaseBranch',
      message: 'Welcome to the Irving release wizard! Which release branch would you like to merge?'
    },
  ])
  .then(({ releaseBranch }) => {
    execSync(`git checkout ${releaseBranch}`);
    execSync('git checkout release-merge');
    execSync(`git merge ${releaseBranch}`);

    return inquirer.prompt([
      {
        type: 'confirm',
        name: 'dependencies',
        message: 'have any dependencies been installed in the release branch that have not been merged into main?',
      },
    ]);
  });
